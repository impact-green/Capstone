{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/yueshanlin/Documents/capstoneProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _toConsumableArray from\"/Users/yueshanlin/Documents/capstoneProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/yueshanlin/Documents/capstoneProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yueshanlin/Documents/capstoneProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/yueshanlin/Documents/capstoneProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/yueshanlin/Documents/capstoneProject/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{connect}from'react-redux';import*as actions from'../../store/actions/auth';import*as XLSX from'xlsx';import*as papa from'papaparse';import axios from'axios';import rush from'../../static/icons/rush-11.png';import firstPage from\"../../static/icons/first_page.svg\";import uploadImg from'../../static/icons/upload.png';import{Button,Input}from'@material-ui/core';import{withStyles}from'@material-ui/core/styles';import CircularProgress from'@material-ui/core/CircularProgress';import'./Uploader.css';var StyledButton=withStyles({root:{background:'#F4F6F9',borderRadius:3,border:'1px solid #728A12',height:42,width:241,'&:hover':{boxShadow:'0px 0px 3px #0070D2',borderRadius:'4px'},// display: 'flex',\n// flexDirection: 'row',\n// alignItems: 'center',\npadding:'1px 16px'},label:{textTransform:'capitalize'}})(Button);var Uploader=/*#__PURE__*/function(_React$Component){_inherits(Uploader,_React$Component);var _super=_createSuper(Uploader);function Uploader(props){var _this;_classCallCheck(this,Uploader);_this=_super.call(this,props);_this.onChangeHandler=function(e){if(e.target.files===undefined||e.target.files.length==0||e.target.files[0].name===undefined||e.target.files[0].name.split(',').length==0){return;}if(e.target.files[0].name.split('.').pop().toLowerCase()!='xlsx'){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),['The file should have extension of \"xlsx\"'])});}else{_this.setState({file:e.target.files[0],mainState:\"uploaded\",selectedFile:e.target.files[0].name});}};_this.parseContractors=function(worksheet,sheetName){var properties=['Contractor Name','Contractor Description'];var csvString=XLSX.utils.sheet_to_csv(worksheet,{header:1});var json=papa.parse(csvString,{header:true});// filter empty cell.\nvar newJson=_this.deleteEmptyCells(json.data);console.log('123123123123');var _iterator=_createForOfIteratorHelper(newJson),_step;try{var _loop=function _loop(){var item=_step.value;var errors=[];properties.forEach(function(property){_this.checkPropertyExistence(item,property,sheetName,errors);});if(errors.length>0){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),errors)});return{v:void 0};}delete item[''];delete item['Instructions'];item['name']=item['Contractor Name'];item['description']=item['Contractor Description'];delete item['Contractor Name'];delete item['Contractor Description'];};for(_iterator.s();!(_step=_iterator.n()).done;){var _ret=_loop();if(typeof _ret===\"object\")return _ret.v;}}catch(err){_iterator.e(err);}finally{_iterator.f();}return newJson;};_this.deleteEmptyCells=function(jsonArray){return jsonArray.filter(function(item){for(var key in item){if(item[key].trim()!=''){return true;}}return false;});};_this.checkPropertyExistence=function(item,property,sheetName,errors){if(!item.hasOwnProperty(property)){errors.push('Sheet: \\''+sheetName+'\\' has no column: \\''+property+'\\'');}};_this.parseProjects=function(worksheet,sheetName){var properties=['Project Name','Project Number','Project Description','Contractor','SDG Alignment #1','SDG Alignment #2'];var csvString=XLSX.utils.sheet_to_csv(worksheet,{header:1});var json=papa.parse(csvString,{header:true});// filter empty cell.\nvar newJson=_this.deleteEmptyCells(json.data);// Change key name.\nvar _iterator2=_createForOfIteratorHelper(newJson),_step2;try{var _loop2=function _loop2(){var item=_step2.value;// Check if all properties exist.\nvar errors=[];properties.forEach(function(property){_this.checkPropertyExistence(item,property,sheetName,errors);});if(errors.length>0){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),errors),loading:false});return{v:void 0};}// change key name.\ndelete item['Instructions'];delete item[''];delete item['Project Name and Number'];delete item['Enterprise'];item['name']=item['Project Name'];item['project_number']=item['Project Number'];item['description']=item['Project Description'];item['sdg1']=item['SDG Alignment #1'];item['sdg2']=item['SDG Alignment #2'];delete item['Project Name'];delete item['Project Number'];delete item['Project Description'];delete item['SDG Alignment #1'];delete item['SDG Alignment #2'];};for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _ret2=_loop2();if(typeof _ret2===\"object\")return _ret2.v;}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return newJson;};_this.parseBonds=function(worksheet,sheetName){var properties=['Issue Year','Series','Enterprise','Bond Type','Bond Name','CUSIP','Green Bond Verifier (If Applicable)','Coupon Rate','Final Maturity Date'];var csvString=XLSX.utils.sheet_to_csv(worksheet,{header:1});var json=papa.parse(csvString,{header:true});var newJson=_this.deleteEmptyCells(json.data);// Change key name.\nvar _iterator3=_createForOfIteratorHelper(newJson),_step3;try{var _loop3=function _loop3(){var item=_step3.value;var errors=[];properties.forEach(function(property){_this.checkPropertyExistence(item,property,sheetName,errors);});if(errors.length>0){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),errors)});return{v:void 0};}delete item['Instructions'];delete item[''];item['name']=item['Bond Name'];item['enterprise']=item['Enterprise'];item['avg_mature_rate']=parseFloat(item['Coupon Rate'])/100.0;item['bond_type']=item['Bond Type'];item['issue_year']=parseInt(item['Issue Year']);item['series']=item['Series'];item['verifier']=item['Green Bond Verifier (If Applicable)'];item['maturity_date']=item['Final Maturity Date'];delete item['Bond Name'];delete item['Enterprise'];delete item['Coupon Rate'];delete item['Bond Type'];delete item['Issue Year'];delete item['Series'];delete item['Green Bond Verifier (If Applicable)'];delete item['Final Maturity Date'];};for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _ret3=_loop3();if(typeof _ret3===\"object\")return _ret3.v;}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}console.log('99999999 bond');console.log(newJson);return newJson;};_this.parseFinancialInfo=function(worksheets){var GAP=7;var BOND_INITIAL_COL=3;var PROJECT_INITIAL_COL=2;var financialInfo=[];var _iterator4=_createForOfIteratorHelper(worksheets),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var worksheet=_step4.value;var csvString=XLSX.utils.sheet_to_csv(worksheet);var parsedData=papa.parse(csvString);for(var j=BOND_INITIAL_COL;j<parsedData.data[0].length;j+=GAP){if(parsedData.data[0][j]===undefined||parsedData.data[0][j].toString().trim()==''){continue;}var bond_name=parsedData.data[0][j];financialInfo.push({bond:bond_name,projects:[]});}var number_error='Financial data should be decimal!';for(var _j=PROJECT_INITIAL_COL,counter=0;counter<financialInfo.length;_j+=GAP,counter++){for(var i=2;i<parsedData.data.length;i++){if(parsedData.data[i][_j]===undefined||parsedData.data[i][_j+1]===undefined||parsedData.data[i][_j+2]===undefined||parsedData.data[i][_j+3]===undefined||parsedData.data[i][_j].toString().trim()==''||parsedData.data[i][_j+1].toString().trim()==''||parsedData.data[i][_j+2].toString().trim()==''||parsedData.data[i][_j+3].toString().trim()==''){continue;}var project=void 0,use_of_proceeds=void 0,prior_year_spending=void 0,recent_year_spending=void 0;try{project=parsedData.data[i][_j].toString();use_of_proceeds=parseFloat(parsedData.data[i][_j+1].toString().substring(1).replace(/,/g,''));prior_year_spending=parseFloat(parsedData.data[i][_j+2].toString().substring(1).replace(/,/g,''));recent_year_spending=parseFloat(parsedData.data[i][_j+3].toString().substring(1).replace(/,/g,''));}catch(err){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),[number_error])});return;}financialInfo[counter].projects.push({project:project,use_of_proceeds:use_of_proceeds,prior_year_spending:prior_year_spending,recent_year_spending:recent_year_spending});}}}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}return financialInfo;};_this.parseTimeSeries=function(worksheets){var PROJECT_INITIAL_COL=3,GAP=12;var timeSeries=[];var _iterator5=_createForOfIteratorHelper(worksheets),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var worksheet=_step5.value;var csvString=XLSX.utils.sheet_to_csv(worksheet);var parsedData=papa.parse(csvString);var j=PROJECT_INITIAL_COL;while(true){if(parsedData.data[0][j]===undefined||parsedData.data[0][j].toString().trim()==''){break;}if(parsedData.data.length==0){break;}var k=j;while(true){if(parsedData.data[1][k]===undefined||parsedData.data[1][k].toString().trim()==''){break;}//TODO: parseInt\ntimeSeries.push({project:parsedData.data[0][j],year:parseInt(parsedData.data[1][k]),status:parsedData.data[2][k],household_connections_count:parseInt(parsedData.data[3][k]),people_with_access_to_utilities_count:parseInt(parsedData.data[4][k]),people_benefiting_count:parseInt(parsedData.data[5][k]),ghg_emissions_business_as_usual:parseFloat(parsedData.data[7][k]),ghg_emissions_actual_emissions:parseFloat(parsedData.data[8][k]),water_reduction:parseFloat(parsedData.data[15][k]),water_catchment:parseFloat(parsedData.data[16][k])});k++;}j=k+2;}}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}return timeSeries;};_this.checkSheetExistence=function(sheet,sheetName){var newError='The sheet \\' '+sheetName+' \\' doesn\\'t exist!';if(sheet===undefined){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),[newError]),loading:false});return false;}return true;};_this.onClickHandler=function(){_this.setState({loading:true});var PROJECT_INFO_SHEET=\"Project Information\";var BOND_INFO_SHEET=\"Bond Information\";var FINANCIAL_INFO_SHEET_PREFIX=\"Financial Information - Bonds\";var CONTRACTOR_INFO_SHEET=\"Contractor Information\";var ENVIRONMENTAL_INFO_SHEET_PREFIX=\"Environmental Information\";var reader=new FileReader();reader.onload=function(e){// Clear errors.\n_this.setState({errors:[]});var result=e.target.result;// TODO: parse xlsx error.\nvar workbook=XLSX.read(result,{type:'binary'});var projectWorksheet=workbook.Sheets[PROJECT_INFO_SHEET];var bondWorksheet=workbook.Sheets[BOND_INFO_SHEET];var contractorWorksheet=workbook.Sheets[CONTRACTOR_INFO_SHEET];// Check sheets existence.\nvar existence1=_this.checkSheetExistence(projectWorksheet,PROJECT_INFO_SHEET);var existence2=_this.checkSheetExistence(bondWorksheet,BOND_INFO_SHEET);var existence3=_this.checkSheetExistence(contractorWorksheet,CONTRACTOR_INFO_SHEET);var financialInfoWorksheets=[];var existence4=false;workbook.SheetNames.forEach(function(sheetName){if(sheetName.startsWith(FINANCIAL_INFO_SHEET_PREFIX)){financialInfoWorksheets.push(workbook.Sheets[sheetName]);existence4=true;}});var timeSeriesWorksheets=[];var existence5=false;workbook.SheetNames.forEach(function(sheetName){if(sheetName.startsWith(ENVIRONMENTAL_INFO_SHEET_PREFIX)){timeSeriesWorksheets.push(workbook.Sheets[sheetName]);existence5=true;}});var noFinancialSheetError='There is not sheet with name: '+FINANCIAL_INFO_SHEET_PREFIX+\"...\";var noEnvironmentSheetError='There is not sheet with name: '+ENVIRONMENTAL_INFO_SHEET_PREFIX+\"...\";if(!existence4){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),[noFinancialSheetError]),loading:false});}if(!existence5){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),[noEnvironmentSheetError]),loading:false});}if(!existence1||!existence2||!existence3){return;}var contractors=_this.parseContractors(contractorWorksheet,CONTRACTOR_INFO_SHEET);var projects=_this.parseProjects(projectWorksheet,PROJECT_INFO_SHEET);var bonds=_this.parseBonds(bondWorksheet,BOND_INFO_SHEET);var financialInfo=_this.parseFinancialInfo(financialInfoWorksheets);var timeSeries=_this.parseTimeSeries(timeSeriesWorksheets);if(contractors===undefined||projects===undefined||bonds===undefined||financialInfo===undefined||timeSeries===undefined){return;}var json={contractors:contractors,projects:projects,bonds:bonds,financialInfo:financialInfo,timeSeries:timeSeries};console.log(\"time series:\");console.log(timeSeries);axios.post(\"http://127.0.0.1:8000/api/create\",json).then(function(res){if(res===undefined||res.status!='200'){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),['res']),loading:false});}else{_this.setState({errors:['Upload Successful!'],loading:false});}}).catch(function(error){if(!error.response.data.hasOwnProperty('errors')){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),['Unknown error!']),loading:false});return;}error.response.data['errors'].forEach(function(err){_this.setState({errors:[].concat(_toConsumableArray(_this.state.errors),[err]),loading:false});});});};reader.readAsBinaryString(_this.state.file);};_this.state={mainState:\"initial\",file:'',errors:[],selectedFile:null,loading:false};return _this;}_createClass(Uploader,[{key:\"render\",value:function render(){var _this2=this;var errors=this.state.errors;var file=this.state.file;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"Swiper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"Swiper-item page-one\"},/*#__PURE__*/React.createElement(\"img\",{className:\"page-one-bg\",src:rush,alt:\"rush\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"page-one-content\"},/*#__PURE__*/React.createElement(\"p\",{className:\"page-one-title\"},\"Welcome to the Issuer Portal\"),/*#__PURE__*/React.createElement(\"p\",{className:\"page-one-desc\"},\"Share your instutitions progress towards meeting\",/*#__PURE__*/React.createElement(\"br\",null),\"climate-aligned internal goals with investors driven by impact\")))),/*#__PURE__*/React.createElement(\"div\",{className:\"download\"},/*#__PURE__*/React.createElement(\"p\",{className:\"download-desc\"},\"Our team developed an Excel template for issuers to upload their data to our tool. Be sure to carefully input \",/*#__PURE__*/React.createElement(\"br\",null),\"information and read through thoroughly to avoid any errors. \"),/*#__PURE__*/React.createElement(\"div\",{className:\"dButtons\"},/*#__PURE__*/React.createElement(StyledButton,{style:{marginLeft:'267px'},variant:\"outlined\",className:\"download-button\",href:\"https://drive.google.com/uc?export=download&id=1_zW_gwxbfZ7fMrAMQD52Yl8SURyh9Kmj\"},/*#__PURE__*/React.createElement(\"div\",{className:\"plabel\"},\"Download Template\"),/*#__PURE__*/React.createElement(\"img\",{className:\"arrow\",src:firstPage,alt:\"firstPage\"})),/*#__PURE__*/React.createElement(StyledButton,{style:{marginLeft:'267px'},variant:\"outlined\",className:\"download-button\",href:\"https://drive.google.com/uc?export=download&id=1txOF9AIOFd__E9sOEIqSdJxX0tsZCi-H\"},/*#__PURE__*/React.createElement(\"div\",{className:\"plabel\"},\"Download Example\"),/*#__PURE__*/React.createElement(\"img\",{className:\"arrow\",src:firstPage,alt:\"firstPage\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"upload\"},/*#__PURE__*/React.createElement(\"p\",{className:\"upload-desc\"},\"Once you\\u2019ve filled out the sheet, double check to ensure that you\\u2019ve added your institution\\u2019s name and the reporting \",/*#__PURE__*/React.createElement(\"br\",null),\"year. This will investors to ensure they are receiving the most up-to-date information from your institution. \"),/*#__PURE__*/React.createElement(\"input\",{accept:\".xlsx\",style:{display:'none'},id:\"raised-button-file\",multiple:true,type:\"file\",onChange:function onChange(e){return _this2.onChangeHandler(e);}}),/*#__PURE__*/React.createElement(StyledButton,{style:{marginLeft:'520px'},variant:\"raised\",component:\"span\",className:\"select-button\",htmlFor:\"raised-button-file\"},/*#__PURE__*/React.createElement(\"label\",{className:\"select-button\",htmlFor:\"raised-button-file\"},/*#__PURE__*/React.createElement(\"div\",{className:\"plabel\"},\"Select File\"),/*#__PURE__*/React.createElement(\"img\",{className:\"arrow\",src:uploadImg,alt:\"uploadImg\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"file\"},/*#__PURE__*/React.createElement(\"div\",{className:\"file-name\"},/*#__PURE__*/React.createElement(\"label\",{className:\"file-label\"},\"\".concat(this.state.selectedFile===null?'No File Selected':this.state.selectedFile))),this.state.loading?/*#__PURE__*/React.createElement(\"div\",{style:{marginTop:'34px',marginLeft:'30px'}},/*#__PURE__*/React.createElement(CircularProgress,{size:20})):file&&/*#__PURE__*/React.createElement(StyledButton,{variant:\"outlined\",style:{width:'100px',height:'40px',marginTop:'34px',marginLeft:'30px'},onClick:this.onClickHandler},/*#__PURE__*/React.createElement(\"label\",{className:\"plabel\"},\"Upload\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"errorMessage\"},errors&&errors.map(function(error){return/*#__PURE__*/React.createElement(\"p\",null,error);}))));}}]);return Uploader;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{loading:state.loading,errors:state.errors};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{onAuth:function onAuth(username,password){return dispatch(actions.authLogin(username,password));}};};export default connect(mapStateToProps,mapDispatchToProps)(Uploader);","map":{"version":3,"sources":["/Users/yueshanlin/Documents/capstoneProject/src/containers/Uploader/Uploader.js"],"names":["React","connect","actions","XLSX","papa","axios","rush","uploadImg","Button","Input","withStyles","CircularProgress","StyledButton","root","background","borderRadius","border","height","width","boxShadow","padding","label","textTransform","Uploader","props","onChangeHandler","e","target","files","undefined","length","name","split","pop","toLowerCase","setState","errors","state","file","mainState","selectedFile","parseContractors","worksheet","sheetName","properties","csvString","utils","sheet_to_csv","header","json","parse","newJson","deleteEmptyCells","data","console","log","item","forEach","property","checkPropertyExistence","jsonArray","filter","key","trim","hasOwnProperty","push","parseProjects","loading","parseBonds","parseFloat","parseInt","parseFinancialInfo","worksheets","GAP","BOND_INITIAL_COL","PROJECT_INITIAL_COL","financialInfo","parsedData","j","toString","bond_name","bond","projects","number_error","counter","i","project","use_of_proceeds","prior_year_spending","recent_year_spending","substring","replace","err","parseTimeSeries","timeSeries","k","year","status","household_connections_count","people_with_access_to_utilities_count","people_benefiting_count","ghg_emissions_business_as_usual","ghg_emissions_actual_emissions","water_reduction","water_catchment","checkSheetExistence","sheet","newError","onClickHandler","PROJECT_INFO_SHEET","BOND_INFO_SHEET","FINANCIAL_INFO_SHEET_PREFIX","CONTRACTOR_INFO_SHEET","ENVIRONMENTAL_INFO_SHEET_PREFIX","reader","FileReader","onload","result","workbook","read","type","projectWorksheet","Sheets","bondWorksheet","contractorWorksheet","existence1","existence2","existence3","financialInfoWorksheets","existence4","SheetNames","startsWith","timeSeriesWorksheets","existence5","noFinancialSheetError","noEnvironmentSheetError","contractors","bonds","post","then","res","catch","error","response","readAsBinaryString","marginLeft","firstPage","display","marginTop","map","Component","mapStateToProps","mapDispatchToProps","dispatch","onAuth","username","password","authLogin"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport * as actions from '../../store/actions/auth';\nimport * as XLSX from 'xlsx';\nimport * as papa from 'papaparse';\nimport axios from 'axios';\nimport rush from '../../static/icons/rush-11.png';\nimport firstPage from '../../static/icons/first_page.svg';\nimport uploadImg from '../../static/icons/upload.png';\nimport { Button, Input } from '@material-ui/core';\nimport { withStyles } from '@material-ui/core/styles';\nimport CircularProgress from '@material-ui/core/CircularProgress'\n\nimport './Uploader.css'\n\nconst StyledButton = withStyles({\n  root: {\n    background: '#F4F6F9',\n    borderRadius: 3,\n    border: '1px solid #728A12',\n    height: 42,\n    width: 241,\n    \n    \n    '&:hover': {\n        boxShadow: '0px 0px 3px #0070D2',\n        borderRadius: '4px',\n      },\n    // display: 'flex',\n    // flexDirection: 'row',\n    // alignItems: 'center',\n    padding: '1px 16px',\n\n  },\n  label: {\n    textTransform: 'capitalize',\n  },\n})(Button);\n\nclass Uploader extends React.Component {\n    constructor(props) {\n        super(props); \n        this.state = {\n            mainState: \"initial\",\n            file: '',\n            errors: [],\n            selectedFile: null,\n            loading: false\n        }\n    };\n\n    onChangeHandler = (e) => {\n        if (e.target.files === undefined \n            || e.target.files.length == 0\n            || e.target.files[0].name === undefined\n            || e.target.files[0].name.split(',').length == 0) {\n                \n            return;\n        }\n\n        if (e.target.files[0].name.split('.').pop().toLowerCase() != 'xlsx') {\n            this.setState({\n                errors: [\n                    ...this.state.errors,\n                    'The file should have extension of \"xlsx\"'\n                ]\n            });\n        } else {\n            this.setState({\n                file: e.target.files[0],\n                mainState: \"uploaded\",\n                selectedFile: e.target.files[0].name,\n            });\n        }\n    }\n\n    parseContractors = (worksheet, sheetName) => {\n        const properties = ['Contractor Name', 'Contractor Description'];\n\n        const csvString = XLSX.utils.sheet_to_csv(worksheet, {header: 1});\n        const json = papa.parse(csvString, {header: true});\n\n        // filter empty cell.\n        const newJson = this.deleteEmptyCells(json.data);\n        \n        console.log('123123123123');\n        for (let item of newJson) {\n            const errors = [];\n                properties.forEach(property => {\n                    this.checkPropertyExistence(item, property, sheetName, errors);\n                });\n                if (errors.length > 0) {\n                    this.setState({\n                        errors: [\n                            ...this.state.errors,\n                            ...errors\n                        ]\n                    });\n                    return;\n                }\n    \n                delete item[''];\n                delete item['Instructions'];\n    \n                item['name'] = item['Contractor Name'];\n                item['description'] = item['Contractor Description'];\n    \n                delete item['Contractor Name'];\n                delete item['Contractor Description'];\n        }\n\n        return newJson;\n    }\n\n    /**\n     * Delete empty cells.\n     * Helper method.\n     * \n     * @param {JsonArray} jsonArray json array\n     */\n    deleteEmptyCells = (jsonArray) => {\n        return jsonArray.filter(item => {\n            for (let key in item) {\n                if (item[key].trim() != '') {\n                    return true;\n                }\n            }\n            return false;\n        });\n    }\n\n    checkPropertyExistence = (item, property, sheetName, errors) => {\n        if (!item.hasOwnProperty(property)) {\n            errors.push('Sheet: \\'' + sheetName + '\\' has no column: \\'' + property + '\\'');\n        }\n    }\n\n    /**\n     * Parse project information.\n     * \n     * @param {worksheet} worksheet \"Project Information\" worksheet.\n     * @returns Json array of all project information.\n     */\n    parseProjects = (worksheet, sheetName) => {\n        const properties = ['Project Name', 'Project Number', 'Project Description', 'Contractor', 'SDG Alignment #1', 'SDG Alignment #2'];\n\n        const csvString = XLSX.utils.sheet_to_csv(worksheet, {header: 1});\n        const json = papa.parse(csvString, {header: true});\n\n        // filter empty cell.\n        const newJson = this.deleteEmptyCells(json.data);\n\n        // Change key name.\n        for (let item of newJson) {\n            // Check if all properties exist.\n            const errors = [];\n            properties.forEach(property => {\n                this.checkPropertyExistence(item, property, sheetName, errors);\n            });\n            if (errors.length > 0) {\n                this.setState({\n                    errors: [\n                        ...this.state.errors,\n                        ...errors\n                    ],\n                    loading: false\n                });\n                return;\n            }\n\n            // change key name.\n            delete item['Instructions'];\n            delete item[''];\n            delete item['Project Name and Number'];\n            delete item['Enterprise'];\n\n            item['name'] = item['Project Name'];\n            item['project_number'] = item['Project Number'];\n            item['description'] = item['Project Description']\n            item['sdg1'] = item['SDG Alignment #1']\n            item['sdg2'] = item['SDG Alignment #2']\n\n            delete item['Project Name'];\n            delete item['Project Number'];\n            delete item['Project Description'];\n            delete item['SDG Alignment #1'];\n            delete item['SDG Alignment #2'];\n        }\n\n        return newJson;\n    }\n\n    parseBonds = (worksheet, sheetName) => {\n        const properties = ['Issue Year', 'Series', 'Enterprise', 'Bond Type', 'Bond Name', \n            'CUSIP', 'Green Bond Verifier (If Applicable)', 'Coupon Rate', 'Final Maturity Date']\n\n        const csvString = XLSX.utils.sheet_to_csv(worksheet, {header: 1});\n\n        const json = papa.parse(csvString, {header: true});\n        const newJson = this.deleteEmptyCells(json.data);\n\n        // Change key name.\n        for (let item of newJson) {\n            const errors = [];\n            properties.forEach(property => {\n                this.checkPropertyExistence(item, property, sheetName, errors);\n            });\n            if (errors.length > 0) {\n                this.setState({\n                    errors: [\n                        ...this.state.errors,\n                        ...errors\n                    ]\n                });\n                return;\n            }\n\n            delete item['Instructions'];\n            delete item[''];\n\n            item['name'] = item['Bond Name'];\n            item['enterprise'] = item['Enterprise'];\n            item['avg_mature_rate'] = parseFloat(item['Coupon Rate']) / 100.0;\n            item['bond_type'] = item['Bond Type'];\n            item['issue_year'] = parseInt(item['Issue Year']);\n            item['series'] = item['Series'];\n            item['verifier'] = item['Green Bond Verifier (If Applicable)'];\n            item['maturity_date'] = item['Final Maturity Date'];\n\n            delete item['Bond Name'];\n            delete item['Enterprise'];\n            delete item['Coupon Rate'];\n            delete item['Bond Type'];\n            delete item['Issue Year'];\n            delete item['Series'];\n            delete item['Green Bond Verifier (If Applicable)'];\n            delete item['Final Maturity Date'];\n        }\n        console.log('99999999 bond');\n        console.log(newJson);\n        return newJson;\n    }\n\n    parseFinancialInfo = (worksheets) => {\n        const GAP = 7;\n        const BOND_INITIAL_COL = 3;\n        const PROJECT_INITIAL_COL = 2;\n\n        const financialInfo = []\n\n        for (let worksheet of worksheets) {\n            const csvString = XLSX.utils.sheet_to_csv(worksheet);\n            const parsedData = papa.parse(csvString);\n\n            for (let j = BOND_INITIAL_COL; j < parsedData.data[0].length; j += GAP) {\n                if (parsedData.data[0][j] === undefined\n                || parsedData.data[0][j].toString().trim() == '') {\n                    continue;\n                }\n    \n                let bond_name = parsedData.data[0][j];\n                financialInfo.push({\n                    bond: bond_name,\n                    projects: []\n                });\n            }\n    \n            const number_error = 'Financial data should be decimal!';\n            for (let j = PROJECT_INITIAL_COL, counter = 0; counter < financialInfo.length; j += GAP, counter++) {\n                for (let i = 2; i < parsedData.data.length; i++) {\n                    \n                    if (parsedData.data[i][j] === undefined\n                    || parsedData.data[i][j + 1] === undefined\n                    || parsedData.data[i][j + 2] === undefined\n                    || parsedData.data[i][j + 3] === undefined\n                    || parsedData.data[i][j].toString().trim() == ''\n                    || parsedData.data[i][j + 1].toString().trim() == ''\n                    || parsedData.data[i][j + 2].toString().trim() == ''\n                    || parsedData.data[i][j + 3].toString().trim() == '') {\n                        \n                        continue;\n                    }\n    \n                    let project, use_of_proceeds, prior_year_spending, recent_year_spending;\n                    try {\n                        project = parsedData.data[i][j].toString();\n                        use_of_proceeds = parseFloat(parsedData.data[i][j + 1].toString().substring(1).replace(/,/g, ''));\n                        prior_year_spending = parseFloat(parsedData.data[i][j + 2].toString().substring(1).replace(/,/g, ''));\n                        recent_year_spending = parseFloat(parsedData.data[i][j + 3].toString().substring(1).replace(/,/g, ''));\n                    } catch (err) {\n                        this.setState({\n                            errors: [\n                                ...this.state.errors,\n                                number_error\n                            ]\n                        });\n                        return; \n                    }\n                    \n                    financialInfo[counter].projects.push({\n                        project: project,\n                        use_of_proceeds: use_of_proceeds,\n                        prior_year_spending: prior_year_spending,\n                        recent_year_spending: recent_year_spending\n                    });\n                }\n            }\n        }\n        return financialInfo;\n    }\n\n    parseTimeSeries = (worksheets) => {\n        const PROJECT_INITIAL_COL = 3, GAP = 12;\n\n        const timeSeries = [];\n        for (let worksheet of worksheets) {\n            const csvString = XLSX.utils.sheet_to_csv(worksheet);\n            const parsedData = papa.parse(csvString);\n\n            let j = PROJECT_INITIAL_COL;\n            while (true) {\n                if (parsedData.data[0][j] === undefined\n                || parsedData.data[0][j].toString().trim() == '') {\n                    break;\n                }\n\n                if (parsedData.data.length == 0) {\n                    break;\n                }\n\n                let k = j;\n                while (true) {\n                    if (parsedData.data[1][k] === undefined\n                    || parsedData.data[1][k].toString().trim() == '') {\n                        break;\n                    }\n\n                    //TODO: parseInt\n                    timeSeries.push({\n                        project: parsedData.data[0][j],\n                        year: parseInt(parsedData.data[1][k]),\n                        status: parsedData.data[2][k],\n                        \n                        household_connections_count: parseInt(parsedData.data[3][k]),\n                        people_with_access_to_utilities_count: parseInt(parsedData.data[4][k]),\n                        people_benefiting_count: parseInt(parsedData.data[5][k]),\n\n                        ghg_emissions_business_as_usual: parseFloat(parsedData.data[7][k]),\n                        ghg_emissions_actual_emissions: parseFloat(parsedData.data[8][k]),\n\n                        water_reduction: parseFloat(parsedData.data[15][k]),\n                        water_catchment: parseFloat(parsedData.data[16][k])\n                    })\n\n                    k++;\n                }\n                j = k + 2;\n            }\n        }\n        return timeSeries;\n    }\n\n    checkSheetExistence = (sheet, sheetName) => {\n        const newError = 'The sheet \\' ' + sheetName + ' \\' doesn\\'t exist!';\n        if (sheet === undefined) {\n            this.setState({\n                errors: [\n                    ...this.state.errors,\n                    newError\n                ],\n                loading: false\n            });\n            return false;\n        }\n        return true;\n    }\n\n    onClickHandler = () => {\n        this.setState({loading: true});\n        const PROJECT_INFO_SHEET = \"Project Information\";\n        const BOND_INFO_SHEET = \"Bond Information\";\n        const FINANCIAL_INFO_SHEET_PREFIX = \"Financial Information - Bonds\";\n        const CONTRACTOR_INFO_SHEET = \"Contractor Information\";\n        const ENVIRONMENTAL_INFO_SHEET_PREFIX = \"Environmental Information\";\n\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            // Clear errors.\n            this.setState({\n                errors: [],\n                \n            });\n\n            const result = e.target.result;\n            // TODO: parse xlsx error.\n            const workbook = XLSX.read(result, {type: 'binary'});\n\n            const projectWorksheet = workbook.Sheets[PROJECT_INFO_SHEET];\n            const bondWorksheet = workbook.Sheets[BOND_INFO_SHEET];\n            const contractorWorksheet = workbook.Sheets[CONTRACTOR_INFO_SHEET];\n\n            // Check sheets existence.\n            const existence1 = this.checkSheetExistence(projectWorksheet, PROJECT_INFO_SHEET);\n            const existence2 = this.checkSheetExistence(bondWorksheet, BOND_INFO_SHEET);\n            const existence3 = this.checkSheetExistence(contractorWorksheet, CONTRACTOR_INFO_SHEET);\n            \n            const financialInfoWorksheets = [];\n            let existence4 = false;\n            workbook.SheetNames.forEach((sheetName) => {\n                if (sheetName.startsWith(FINANCIAL_INFO_SHEET_PREFIX)) {\n                    financialInfoWorksheets.push(workbook.Sheets[sheetName]);\n                    existence4 = true;\n                }\n            });\n\n            const timeSeriesWorksheets = [];\n            let existence5 = false;\n            workbook.SheetNames.forEach((sheetName) => {\n                if (sheetName.startsWith(ENVIRONMENTAL_INFO_SHEET_PREFIX)) {\n                    timeSeriesWorksheets.push(workbook.Sheets[sheetName]);\n                    existence5 = true;\n                }\n            })\n\n            const noFinancialSheetError = 'There is not sheet with name: ' + FINANCIAL_INFO_SHEET_PREFIX + \"...\";\n            const noEnvironmentSheetError = 'There is not sheet with name: ' + ENVIRONMENTAL_INFO_SHEET_PREFIX + \"...\";\n            if (!existence4) {\n                this.setState({\n                    errors: [\n                        ...this.state.errors,\n                        noFinancialSheetError\n                    ],\n                    loading: false\n                });\n            }\n            if (!existence5) {\n                this.setState({\n                    errors: [\n                        ...this.state.errors,\n                        noEnvironmentSheetError\n                    ],\n                    loading: false\n                });\n            }\n            if (!existence1 || !existence2 || !existence3) {\n                return;\n            }\n\n            const contractors = this.parseContractors(contractorWorksheet, CONTRACTOR_INFO_SHEET);\n            const projects = this.parseProjects(projectWorksheet, PROJECT_INFO_SHEET);\n            const bonds = this.parseBonds(bondWorksheet, BOND_INFO_SHEET);\n            const financialInfo = this.parseFinancialInfo(financialInfoWorksheets);\n            const timeSeries = this.parseTimeSeries(timeSeriesWorksheets);\n\n            if (contractors === undefined\n            || projects === undefined\n            || bonds === undefined\n            || financialInfo === undefined\n            || timeSeries === undefined) {\n\n                return;\n            }\n\n            const json = {\n                contractors: contractors,\n                projects: projects,\n                bonds: bonds,\n                financialInfo: financialInfo,\n                timeSeries: timeSeries\n            }\n\n            console.log(\"time series:\");\n            console.log(timeSeries);\n            \n            axios.post(\"http://127.0.0.1:8000/api/create\", json)\n                .then(res => {\n                    if (res === undefined || res.status != '200') {\n                        this.setState({\n                            errors: [\n                                ...this.state.errors,\n                                'res'\n                            ],\n                            loading: false\n                        });\n                    } else {\n                        this.setState({\n                            errors: [\n                                'Upload Successful!'\n                            ],\n                            loading: false\n                        });\n                    }\n                })\n                .catch((error) => {\n                    if (!error.response.data.hasOwnProperty('errors')) {\n                        this.setState({\n                            errors:[\n                                ...this.state.errors,\n                                'Unknown error!'\n                            ],\n                            loading: false\n                        });\n                        return;\n                    }\n                    error.response.data['errors'].forEach((err) => {\n                        this.setState({\n                            errors: [\n                                ...this.state.errors,\n                                err\n                            ],\n                            loading: false\n                        });\n                    });\n                });\n        };\n\n        reader.readAsBinaryString(this.state.file);\n    }\n\n    render() {\n        const errors = this.state.errors;\n        const file = this.state.file;\n\n        return (\n            <div>\n                <div className = \"Swiper\">\n                \n                    <div className=\"Swiper-item page-one\">\n        \n                    <img className=\"page-one-bg\" src={rush} alt=\"rush\" />\n                        <div className=\"page-one-content\">\n                            <p className=\"page-one-title\">Welcome to the Issuer Portal</p>\n                            <p className=\"page-one-desc\">Share your instutitions progress towards meeting \n                            <br></br>climate-aligned internal goals with investors driven by impact</p>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"download\">\n                    \n                    <p className=\"download-desc\">Our team developed an Excel template for issuers to upload their data to our tool. Be sure to carefully input <br></br>information and read through thoroughly to avoid any errors. </p>\n                    <div className=\"dButtons\">\n                    {/* sharelink: https://drive.google.com/file/d/1_zW_gwxbfZ7fMrAMQD52Yl8SURyh9Kmj/view?usp=sharing*/}\n                    <StyledButton style = {{marginLeft: '267px'}} variant=\"outlined\" className=\"download-button\" href=\"https://drive.google.com/uc?export=download&amp;id=1_zW_gwxbfZ7fMrAMQD52Yl8SURyh9Kmj\"> \n                        <div className=\"plabel\">Download Template</div> \n                        <img className=\"arrow\" src={firstPage} alt=\"firstPage\" />\n                    </StyledButton>\n                    {/* sharelink: https://drive.google.com/file/d/1txOF9AIOFd__E9sOEIqSdJxX0tsZCi-H/view?usp=sharing*/}\n                    <StyledButton  style = {{marginLeft: '267px'}} variant=\"outlined\" className=\"download-button\" href=\"https://drive.google.com/uc?export=download&amp;id=1txOF9AIOFd__E9sOEIqSdJxX0tsZCi-H\"> \n                        <div className=\"plabel\">Download Example</div> \n                        <img className=\"arrow\" src={firstPage} alt=\"firstPage\" />\n                    </StyledButton>\n                    </div>\n                </div>\n                <div className=\"upload\">\n                    <p className=\"upload-desc\">Once you’ve filled out the sheet, double check to ensure that you’ve added your institution’s name and the reporting <br></br>year. This will investors to ensure they are receiving the most up-to-date information from your institution. </p>\n                    <input \n                    accept=\".xlsx\"\n                    style={{ display: 'none' }}\n                    id=\"raised-button-file\"\n                    multiple\n                    type=\"file\"\n                    onChange={e => this.onChangeHandler(e)} />\n\n                    \n                    <StyledButton  style = {{marginLeft: '520px'}} variant=\"raised\" component=\"span\" className=\"select-button\" htmlFor=\"raised-button-file\"> \n                    <label className=\"select-button\" htmlFor=\"raised-button-file\">\n                        <div className=\"plabel\">Select File</div>\n                        <img className=\"arrow\" src={uploadImg} alt=\"uploadImg\" />\n                    </label>\n                    </StyledButton>\n                    \n                    <div className=\"file\">\n\n                    <div className=\"file-name\">\n                        <label className=\"file-label\">{`${this.state.selectedFile === null ? 'No File Selected': this.state.selectedFile}`}</label>\n                    </div>\n\n\n                    {\n                    this.state.loading ?\n                    <div style={{    marginTop: '34px',\n                        marginLeft: '30px'}}>\n                    <CircularProgress size={20} />\n                    </div>\n                    \n                    :\n                    file &&\n                        \n                        <StyledButton variant=\"outlined\" style={{\n                            width: '100px', \n                            height: '40px',\n                            marginTop: '34px',\n                            marginLeft: '30px'\n                        }} \n                            onClick={this.onClickHandler}> \n                        <label className=\"plabel\">Upload</label>\n                        \n                        </StyledButton>\n\n                    }\n                    \n                    </div>\n                    <div className=\"errorMessage\">\n                        {errors && (\n                            errors.map(error => <p>{error}</p>)\n                        )}\n                    </div>\n                </div>\n            </div>    \n        )    \n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        loading: state.loading,\n        errors: state.errors\n    }\n}\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        onAuth: (username, password) => dispatch(actions.authLogin(username, password))\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (Uploader);"]},"metadata":{},"sourceType":"module"}